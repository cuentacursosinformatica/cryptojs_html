<!DOCTYPE html>
<html>
<head>
<title>CryptoJS AES-128 simple</title>
	<link rel="icon" href="data:,">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
	* {
  box-sizing: border-box; /* incluye padding y border en el width */
		
}
  a.invisible-link {
    color: inherit;
    text-decoration: none;
    cursor: default;
  }

body{ font-family:verdana;font-size:14px; }
h1 { border-bottom: solid 1px red; border-color:grey; }

div {
  margin-top: 0px;
  margin-bottom: 4px;
  width: 90%;
  margin-left: 16px;
}

label { 
	width:250px;
	margin-bottom: 1px;
	display: block;
}

input {
	width: 100%;
	margin-top: 4px;
	margin-bottom: 8px;
}
button {height: 25px;
		margin-bottom: 6px;}
.boton_grande { width:100%; }
textarea {width: 100%;margin-top: 4px;margin-bottom: 4px;}

footer {
  width: 90%;
  margin-top: 20px;
  margin-left: 16px;
  padding-left: 0px;
  text-align: center;
  background-color: #f5f5f5;
  border-top: 1px solid #ddd;
  font-size: 14px;
  color: #666;
}

footer div {
    margin: 0;
	}

/* Estilos para el indicador de fortaleza */
.password-container {
  position: relative;
}

.fortaleza-password {
  position: absolute;
  right: 10px;
  top: 32px;
  font-size: 14px;
  font-weight: bold;
  padding: 2px 8px;
  border-radius: 3px;
  display: none;
}

.fortaleza-baja {
  color: #d32f2f;          /* Rojo oscuro */
  background-color: #ffebee; /* Fondo rojo claro */
}

.fortaleza-bien {
  color: #f57c00;          /* Naranja */
  background-color: #fff3e0; /* Fondo naranja claro */
}

.fortaleza-mejor {
  color: #388e3c;          /* Verde */
  background-color: #e8f5e9; /* Fondo verde claro */
}
	
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>

<script>

function comprobarFortaleza() {
  const password = document.getElementById("tu_password").value;
  const indicador = document.getElementById("fortaleza_indicador");
  const longitud = password.length;
  
  // Si no hay contraseña, ocultar indicador
  if (longitud === 0) {
    indicador.style.display = "none";
    return;
  }
  
  // Mostrar indicador
  indicador.style.display = "block";
  
  // Eliminar clases anteriores
  indicador.classList.remove("fortaleza-baja", "fortaleza-bien", "fortaleza-mejor");
  
  // Evaluar fortaleza según longitud
  if (longitud < 12) {
    indicador.textContent = "Baja";
    indicador.classList.add("fortaleza-baja");
  } else if (longitud < 32) {
    indicador.textContent = "Bien";
    indicador.classList.add("fortaleza-bien");
  } else {
    indicador.textContent = "Mejor";
    indicador.classList.add("fortaleza-mejor");
  }
}

	
// Validar que los campos no están vacíos antes de la operación
function validarCampos() {
  const password = document.getElementById("tu_password").value.trim();
  const password_confirm = document.getElementById("tu_password_confirm").value.trim();
  const mensaje = document.getElementById("mensaje_cifrar").value.trim();
  
  // Verificar que la contraseña no esté vacía
  if (password === "") {
    alert("⚠️ Por favor, escribe una contraseña");
    document.getElementById("tu_password").focus();
    return false;
  }
  
  // Verificar que la confirmación no esté vacía
  if (password_confirm === "") {
    alert("⚠️ Por favor, confirma tu contraseña");
    document.getElementById("tu_password_confirm").focus();
    return false;
  }
  
  // Verificar que ambas contraseñas coincidan
  if (password !== password_confirm) {
    alert("❌ Las contraseñas no coinciden. Por favor, verifica.");
    document.getElementById("tu_password_confirm").focus();
    document.getElementById("tu_password_confirm").select();
    return false;
  }
  
  // Verificar que el mensaje no esté vacío
  if (mensaje === "") {
    alert("⚠️ Por favor, escribe un mensaje");
    document.getElementById("mensaje_cifrar").focus();
    return false;
  }
  
  return true; // Todo OK
}
 

function copiarTextoCifrado(){
	const mensaje_cifrado = document.getElementById("mensaje_cifrado").value
	//console.log(texto);
	if (mensaje_cifrado !== "") {
	navigator.clipboard.writeText(mensaje_cifrado)
		.then(() => { 
            console.log("Salida copiada, ahora se puede pegar en otra app...");
            //alert("Texto copiado, ahora puedes pegarlo en otra aplicación");
             })
		.catch(err => { console.log("Error al copiar: ", err); });
}}

	function cifrar(){
	if (!validarCampos()) {
    	return; // Sale de la función si hay error
  		}
	const password = document.getElementById("tu_password").value;
	const mensaje = document.getElementById("mensaje_cifrar").value;
	const mensaje_cifrado_caja = document.getElementById("mensaje_cifrado");
	const mensaje_cifrado = CryptoJS.AES.encrypt(mensaje, password).toString();
	mensaje_cifrado_caja.value = mensaje_cifrado;
	console.log(mensaje_cifrado);
	//alert("Mensaje secreto:\n"+mensaje_cifrado);
	}

	function descifrar(){
		if (!validarCampos()) {
    		return; // Sale de la función si hay error
  				}
		const password = document.getElementById("tu_password").value;
		const mensaje = document.getElementById("mensaje_cifrar").value;
		const mensaje_cifrado_caja = document.getElementById("mensaje_cifrado");
		const bytes = CryptoJS.AES.decrypt(mensaje, password);
		const mensaje_original = bytes.toString(CryptoJS.enc.Utf8);
		console.log(mensaje_original);
		mensaje_cifrado_caja.value = mensaje_original
		//alert("Mensaje original:\n"+mensaje_original);
}
</script>
</head>
<body>
  <div>
<h1>CryptoJS AES-128 simple</h1>
</div>
<div>
<p>Instrucciones:</p>
<ol>
<li>Escribe tu contraseña
<li>Escribe tu mensaje de entrada
<li>Pulsa el botón cifrar / descifrar
</ol>
<hr><br>
</div>
<div class="password-container">
<label for="tu_password">Contraseña:</label>
<input type="password" name="contraseña" id="tu_password" placeholder="escribe tu contraseña" oninput="comprobarFortaleza()" >
	<span id="fortaleza_indicador" class="fortaleza-password"></span>
</div>
	
<div>
<label for="tu_password_confirm">Repite contraseña:</label>
<input type="password" name="contraseña" id="tu_password_confirm" placeholder="escribe tu contraseña de nuevo" >
</div>

<div>
<label for="mensaje_cifrar">Mensaje entrada:</label>
<input type="text" name="mensaje" id="mensaje_cifrar" placeholder="escribe tu mensaje para cifrar" >
</div>
<br>
<div>
<button type="button" class="boton_grande" onclick="cifrar()">Cifrar</button>	
</div>
<div>
<button type="button" class="boton_grande" onclick="descifrar()">Descifrar</button>
</div>
<br>
<div>
<label for="mensaje_cifrado">Mensaje salida:</label>
<textarea rows="6" type="text" name="mensaje_cifrado" id="mensaje_cifrado" placeholder="escribe tu mensaje para cifrar" ></textarea>
</div>
<div>
<button type="button" class="boton_grande" onclick="copiarTextoCifrado()">Copiar salida</button>
</div>

<footer>
  <div style="width:100%;text-align: center;">
    <p><strong>Cifrador AES-128</strong></p>
    <p>Usando CryptoJS 4.2.0</p>
    <p style="font-size: 12px; color: #888;">
      ⚠️ Para uso educativo ⚠️ </p>
	<p style="font-size: 12px; color: #888;">
	  No usar para datos críticos sin seguridad adicional </p>
	  <p style="font-size: 10px; color: #888;"><a href="index2.html" class="invisible-link">AES-128 (v2)</a></p>
	  <p style="font-size: 10px; color: #888;"><a href="index_aes_cbc_pbkdf2.html" class="invisible-link">AES-256 CBC PBKDF2</a></p>
	  <p style="font-size: 12px; color: #888;">05-12-25</p>
<br>
  </div>
</footer>

</body>
</html>
